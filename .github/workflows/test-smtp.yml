name: Test SMTP Port 25

on:
  workflow_dispatch:

jobs:
  test-smtp:
    runs-on: ubuntu-latest
    steps:
      - name: Test Port 25 to Google
        run: |
          echo "Testing port 25 connectivity..."
          nc -zv -w 10 smtp.google.com 25 || echo "Google SMTP failed"

      - name: Test Port 25 to Microsoft
        run: |
          nc -zv -w 10 microsoft-com.mail.protection.outlook.com 25 || echo "Microsoft SMTP failed"

      - name: Test Port 25 to Dolby
        run: |
          nc -zv -w 10 mxb-000fd501.gslb.pphosted.com 25 || echo "Dolby SMTP failed"

      - name: Python SMTP Test
        run: |
          python3 << 'EOF'
          import smtplib
          import socket

          def test_smtp(host, port=25):
              try:
                  sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                  sock.settimeout(10)
                  result = sock.connect_ex((host, port))
                  sock.close()
                  return result == 0
              except Exception as e:
                  print(f"Error: {e}")
                  return False

          hosts = [
              "smtp.google.com",
              "microsoft-com.mail.protection.outlook.com",
              "mxb-000fd501.gslb.pphosted.com"
          ]

          for host in hosts:
              result = "OPEN" if test_smtp(host) else "BLOCKED"
              print(f"{host}: Port 25 is {result}")
          EOF
